package com.garage.service;

import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.stereotype.Service;

import com.garage.model.Vehicle;
import com.garage.storage.FileStorage;

@Service
public class VehicleService {

	 private final FileStorage storage;
	    private final List<Vehicle> vehicles;

	    public VehicleService(FileStorage storage) {
	        this.storage = storage;
	        this.vehicles = new ArrayList<>();
	    }

	    public void addVehicle(Vehicle v) {
	        v.setStatus("New");
	         
	        vehicles.add(v);
	        storage.save(vehicles);
	    }

	    public void changeStatus(String plate, String newStatus) {
	    	int total = 0;
	        vehicles.stream()
	                .filter(v -> v.getLicensePlate().equalsIgnoreCase(plate))
	                .findFirst()
	                .ifPresent(v -> {
	                    v.setStatus(newStatus);
	                    if (newStatus.equals("Released"))
	                    	
	                    	totalBill(v);
	                    	
	                        vehicles.remove(v);
	                });
	        storage.save(vehicles);
	    }

	    private int totalBill(Vehicle v) {
			int price=0;
	    	price=price+v.getPrice();

	    	return price;
		}

		public List<Vehicle> searchByPlate(String plate) {
	        return vehicles.stream()
	                .filter(v -> v.getLicensePlate().equalsIgnoreCase(plate))
	                .collect(Collectors.toList());
	    }

	    public List<Vehicle> searchByDescription(String keyword) {
	        return vehicles.stream()
	                .filter(v -> v.getDescription().contains(keyword))
	                .collect(Collectors.toList());
	    }

	    public List<Vehicle> listByStatus(String status) {
	        return vehicles.stream()
	                .filter(v -> !v.getStatus().equals("Released"))
	                .collect(Collectors.toList());
	    }

	    public List<Vehicle> sortByYear() {
	        return vehicles.stream()
	                .sorted(Comparator.comparing(Vehicle::getYear))
	                .collect(Collectors.toList());
	    }

	    public int totalProfit() {
	        return vehicles.stream()
	                .filter(v -> v.getStatus().equals("Released"))
	                .mapToInt(Vehicle::getPrice)
	                .sum();
	    }

}
